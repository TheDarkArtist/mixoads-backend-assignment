./SUBMISSION.md
# Backend Engineer Assignment - Submission

**Name:** Kushagra Sharma \
**Date:** Mon, Dec 29, 2025 \
**Time Spent:** [Honest estimate] \
**GitHub:** TheDarkArtist

---

## Part 1: What Was Broken

#### Issue 1: Hardcoded credentials and sensitive data logging

**What was wrong:**
The sync logic hardcodes API credentials directly in source code and logs both the Base64-encoded Basic Authorization header and the issued Bearer access token to stdout.

**Why it mattered:**
This results in immediate credential exposure via logs and source control, violating basic security hygiene. In a real production system this would constitute a critical incident requiring key rotation and log scrubbing.

**Where in the code:**
Authentication logic and logging in `syncAllCampaigns` (`src/syncCampaigns.ts`).

---

#### Issue 2: Incomplete pagination leading to data loss

**What was wrong:**
The campaign fetch logic retrieves only the first page of results and ignores the pagination metadata (`has_more`, `total`). As a result, only 10 of the expected 100 campaigns are processed.

**Why it mattered:**
This causes silent data loss and incorrect business state, which is more dangerous than explicit failures because it may go unnoticed.

**Where in the code:**
Campaign fetching logic in `syncAllCampaigns` (`src/syncCampaigns.ts`).

---

#### Issue 3: No rate limit handling despite explicit API constraints

**What was wrong:**
The client makes sequential API requests without any awareness of the platform’s enforced rate limit (10 requests per minute). Responses with HTTP 429 are not handled, and the `retry-after` signal is ignored.

**Why it mattered:**
Under realistic conditions the sync process will reliably exceed rate limits, resulting in cascading failures and incomplete syncs.

**Where in the code:**
All API request paths in `syncAllCampaigns` (`src/syncCampaigns.ts`).

---

#### Issue 4: Missing retry strategy for transient failures

**What was wrong:**
The API intentionally returns transient 503 errors and simulated timeouts, but the client does not implement retries, exponential backoff, or jitter. Failures are either thrown or logged and skipped.

**Why it mattered:**
This makes the sync process non-deterministic and unreliable, producing different results across runs for the same input.

**Where in the code:**
API request handling and sync loop in `syncAllCampaigns` (`src/syncCampaigns.ts`).

---

#### Issue 5: Incorrect timeout configuration

**What was wrong:**
The campaign sync endpoint intentionally responds after ~2 seconds, while the client timeout for the same request is configured to 1 second. This guarantees avoidable timeouts under normal operation.

**Why it mattered:**
Artificially short timeouts amplify failure rates and mask true performance characteristics of the system.

**Where in the code:**What was wrong: Authentica
`fetchWithTimeout` usage during campaign sync (`src/syncCampaigns.ts`).

---

#### Issue 6: Unsafe and inefficient database access patterns

**What was wrong:**
A new database connection pool is created per insert, queries are constructed using string interpolation, and there is no deduplication or idempotency guarantee.

**Why it mattered:**
This can lead to connection leaks, SQL injection vulnerabilities, duplicate records, and poor scalability.

**Where in the code:**
Database access logic in `saveCampaignToDB` (`src/database.ts`).

---

#### Issue 7: Overloaded “god function” architecture

**What was wrong:**
Authentication, API communication, retry logic, business orchestration, persistence, and logging are all implemented within a single function.

**Why it mattered:**
This tight coupling increases cognitive load, makes testing difficult, and raises the risk that fixing one issue introduces regressions elsewhere.

**Where in the code:**
`syncAllCampaigns` (`src/syncCampaigns.ts`).

---

## Part 2: How I Fixed It

For each issue above, explain your fix in detail.

### Fix 1: Authentication security

**My approach:**
Removed hardcoded API credentials from source code and loaded them from environment variables. Eliminated logging of authorization headers and access tokens, and added fail-fast validation when required configuration is missing.

**Why this approach:**
Credential exposure is the highest-severity issue in the system. Fixing it first reduces immediate security risk without altering request flow or business logic.

**Trade-offs:**
The authentication mechanism itself (Basic auth → Bearer token) remains unchanged to match API requirements. Token refresh logic is intentionally deferred.

**Code changes:**
`src/syncCampaigns.ts`

---

### Fix 2: Pagination correctness

**My approach:**
Replaced the single-page campaign fetch with an explicit pagination loop that continues requesting pages until the API indicates no more data via `has_more`.

**Why this approach:**
This is the minimal change required to ensure correctness and prevent silent data loss. It preserves the existing request pattern and avoids introducing concurrency or rate-limit complexity prematurely.

**Trade-offs:**
Pagination is handled sequentially for simplicity. Performance optimizations and rate-limit-aware batching are intentionally deferred.

**Code changes:**
`src/syncCampaigns.ts`

---

### Fix 3: Rate limiting and retry handling (Issues 3 & 4)

**My approach:**
Introduced a centralized request execution path that applies bounded retries with exponential backoff and jitter. Added client-side request pacing to ensure the API’s documented rate limit (10 requests per minute) is never exceeded, including during retries.

**Why this approach:**
Retry logic alone reacts to failures but does not prevent rate limit violations. By enforcing a minimum interval between all outgoing requests, the client proactively respects API constraints and avoids repeated 429 responses.

**Trade-offs:**
The implementation is intentionally conservative and sequential, favoring correctness and predictability over throughput. More advanced approaches (token buckets, adaptive concurrency) were intentionally avoided to keep behavior explicit and debuggable.

**Code changes:**
`src/syncCampaigns.ts`

---

### Fix 4: Timeout policy cleanup

**My approach:**
Centralized all request timeout behavior behind a single, explicitly named configuration value. Ensured that authentication, read, and write requests share the same timeout policy for consistency and predictability.

**Why this approach:**
Timeout values are a core part of system behavior and should be explicit and easy to reason about. Centralizing the policy avoids hidden duplication and makes future tuning safer.

**Trade-offs:**
A single timeout value was chosen for simplicity. With more time, different request classes could justify distinct timeout budgets.

**Code changes:**
`src/syncCampaigns.ts`

---

### Fix 5: Database correctness and idempotency

**My approach:**
Reworked the database layer to use a single shared connection pool and parameterized SQL queries. Added idempotent write behavior using `ON CONFLICT` to ensure repeated syncs are safe.

**Why this approach:**
Database writes must be safe under retries and re-runs. Idempotent upserts prevent duplicate data and allow partial failures to be retried without manual cleanup. Parameterized queries eliminate SQL injection risk.

**Trade-offs:**
This solution assumes a uniqueness constraint on `campaigns.id`. Schema migrations and transactional batching were intentionally avoided to keep the fix focused and minimal.

**Code changes:**
`src/database.ts`

---

## Part 3: Code Structure Improvements

### Structural refactor: Decomposing the sync workflow

**What I changed:**
Split the monolithic sync function into focused, single-purpose units:
- `getAccessToken` for authentication
- `fetchAllCampaigns` for pagination
- `syncCampaign` for per-campaign execution

The main `syncAllCampaigns` function now acts as a thin orchestrator.

**Why it's better:**
This reduces cognitive load, makes individual behaviors easier to test in isolation, and limits the blast radius of future changes. The refactor preserves existing behavior while improving clarity.

**Architecture decisions:**
Chose functional decomposition over new abstractions or class hierarchies to keep the system simple and explicit.

---

### Why I did not split the code into multiple files

Although the sync logic was decomposed into clear, single-responsibility units, I intentionally avoided file-level modularization at this stage.

File boundaries represent a long-term API commitment. In the context of a single-purpose sync job with one execution path and no current reuse pressure, introducing additional files would add indirection without reducing complexity. Keeping the logic co-located preserves readability, makes control flow easy to follow, and minimizes speculative abstraction.

If this code were to be reused by multiple jobs, shared with a web service, or expanded with additional sync strategies, the existing functional boundaries make it straightforward to extract stable modules into separate files without refactoring behavior.

---

## Part 4: Testing & Verification

I verified the fixes by running the sync process end-to-end against the provided mock API under different failure scenarios.

**Test scenarios I ran:**
1. Ran the full campaign sync multiple times to verify idempotency and ensure no duplicate records were created.
2. Observed behavior under simulated 503 errors during pagination and campaign sync to validate retry and backoff logic.
3. Verified client-side rate limiting by inspecting mock API logs to ensure requests were paced at ~1 request per 6 seconds.
4. Restarted the sync mid-run and re-ran it to confirm partial progress could be safely retried.
5. Ran with `USE_MOCK_DB=true` and with a real database connection to verify persistence behavior.

**Expected behavior:**
- All campaigns are eventually fetched and synced.
- Transient failures (503, timeouts) are retried automatically.
- API rate limits are respected and 429 responses are avoided.
- Re-running the sync does not create duplicate database records.
- The process fails fast on unrecoverable errors (e.g., auth failures).

**Actual results:**
- Pagination completed across all pages without data loss.
- Transient failures were retried and recovered successfully.
- Requests were consistently spaced ~6 seconds apart, respecting the API rate limit.
- All campaigns were synced successfully without duplication.
- Failures were explicit and actionable when they occurred.

**Edge cases tested:**
- Missing environment variables for authentication.
- Simulated API outages during pagination.
- Re-running the sync after partial completion.

---

## Part 5: Production Considerations

Before deploying this system to production, I would address the following areas.

### Monitoring & Observability
- Track request rate, retry counts, and error rates (by status code).
- Monitor sync duration and per-campaign latency.
- Alert on sustained failure rates, repeated auth failures, or prolonged sync runtimes.

### Error Handling & Recovery
- Persist sync progress checkpoints to allow resumable execution.
- Add structured error logging with correlation IDs.
- Introduce dead-letter handling for campaigns that repeatedly fail.

### Scaling Considerations
- For 100+ clients, a single sequential worker would become a bottleneck.
- Introduce per-client isolation and controlled concurrency with a global rate limiter.
- Move sync execution to a job queue with worker pools.

### Security Improvements
- Rotate credentials automatically and support token refresh.
- Store secrets in a secure secret manager instead of environment variables.
- Add audit logging for sync operations.

### Performance Optimizations
- Batch database writes where safe.
- Parallelize campaign syncs within rate-limit constraints.
- Cache pagination results where appropriate.


---

## Part 6: Limitations & Next Steps

**Current limitations:**
- Sync execution is intentionally sequential and slow due to strict rate limiting.
- Timeout and retry policies are static and not adaptive.
- No persistent checkpointing of sync progress.
- Limited test coverage beyond manual and integration testing.

**What I’d do with more time:**
- Add automated integration tests with fault injection.
- Introduce resumable sync checkpoints.
- Implement adaptive concurrency with a token-bucket rate limiter.
- Extract the API client into a reusable module if reuse pressure emerges.

**Questions I have:**
- Are campaign syncs expected to be strictly ordered?
- Is eventual consistency acceptable for downstream consumers?
- Are there plans to support incremental or delta-based syncs?

---

## Part 7: How to Run My Solution
Mixo Ads - Backend Challenge
About Mixo Ads
Mixo Ads is transforming AI-driven advertising for multi-location brands. We partner with major U.S. companies and government organizations to automate and optimize ad campaigns at scale.We're a lean, high-impact startup where speed, creativity, and experimentation matter. If you enjoy building data-heavy products and turning complex data into elegant UI, we'd love to see what you build.
Please find the details of the technical assignment below
Questions: hari@mixoads.com
ASSIGNMENT DETAILS
Repository: https://github.com/Mixo-Ads/mixoads-backend-assignment
Time Estimate: 4-5 hours
HOW TO SUBMIT

1. Fork the repository
  - Visit: https://github.com/Mixo-Ads/mixoads-backend-assignment
  - Click "Fork" button (top right)
2. Clone your fork
  git clone https://github.com/YOUR_USERNAME/mixoads-backend-assignment.git
  cd mixoads-backend-assignment
3. Follow setup instructions in README.md
  - Install dependencies
  - Start the mock API
  - Run the broken code
  - Identify what's wrong
4. Fix the issues and complete SUBMISSION.md
  - Fix critical bugs
  - Improve code structure
  - Document your approach thoroughly
5. Push your changes to your fork
  git add .
  git commit -m "Fix bugs and improve structure"
  git push origin main
6. Submit Pull Request
  - Go back to: https://github.com/Mixo-Ads/mixoads-backend-assignment
  - Click "Pull requests" → "New pull request"
  - Click "compare across forks"
  - Select your fork as the source
  - Title: "Backend Engineer Assignment - [Your Name]"
  - Submit PR
IMPORTANT NOTES
- Use any tools you normally use at work (ChatGPT, Claude, Copilot, Stack Overflow, documentation)
- We're testing your problem-solving approach and understanding, not memorization
- After submission, selected candidates will have a 30-45 minute technical review call to discuss your solution
- We'll walk through your code, discuss design decisions, and talk about trade-offs

Clear step-by-step instructions.

### Setup
```bash
# Clone the repository
git clone https://github.com/TheDarkArtist/mixoads-backend-assignment.git
cd mixoads-backend-assignment

# Install dependencies
npm install
````

### Running

```bash
# Terminal 1: start the mock API
cd mock-api
npm install
npm start
```

```bash
# Terminal 2: run the sync job
cd ..
export AD_PLATFORM_EMAIL=admin@mixoads.com
export AD_PLATFORM_PASSWORD=SuperSecret123!
export USE_MOCK_DB=true

npm start
```

### Expected Output

```
Syncing campaigns from Ad Platform...
Fetched 100 campaigns
Sync complete: 100/100 campaigns synced
```

You should also observe:

* Requests paced at ~1 request every 6 seconds
* No repeated 429 rate-limit errors
* Successful retries after simulated 503 errors
* Campaigns being saved once, even across re-runs

### Testing

```bash
# Re-run the sync to verify idempotency and retry safety
npm start
```

```bash
# Optional: run with a real database instead of the mock
unset USE_MOCK_DB
export DB_HOST=localhost
export DB_PORT=5432
export DB_NAME=mixoads
export DB_USER=postgres
export DB_PASSWORD=postgres

npm start
```


---

## Part 8: Additional Notes

I treated this assignment less like a checklist exercise and more like a small production system that I might actually have to wake up for if it broke. The focus was deliberately on correctness, resilience, and respecting external constraints before worrying about speed or structure.

Most changes were made incrementally and committed in isolation to keep the evolution of the system easy to review and reason about. Where the solution is intentionally conservative (sequential execution, strict rate limiting), that was a conscious trade-off in favor of predictability and debuggability over raw throughput.

Overall, the goal was to leave the code in a state where failures are boring, behavior is explainable, and future changes don’t feel scary. If this were to grow beyond the scope of the assignment, the existing boundaries should make that evolution straightforward rather than painful.


---

## Commits Summary

1. `bde2f32` — Document initial failure analysis
   Identified and documented critical security, correctness, and reliability issues in the starter code, focusing on production impact and failure modes. No code changes.

2. `18360a6` — Remove hardcoded credentials and sanitize logs
   Eliminated hardcoded API credentials, moved secrets to environment variables, and removed logging of sensitive authentication data to address a critical security flaw.

3. `ccef16e` — Fix pagination to fetch all campaigns
   Corrected campaign fetching logic to iterate through all paginated results, preventing silent data loss caused by only processing the first page.

4. `f2cec44` — Enforce client-side request pacing
   Added retry logic with exponential backoff and implemented strict client-side rate limiting to respect the API’s 10 requests per minute constraint and avoid repeated 429 errors.

5. `0280648` — Centralize and document request timeout policy
   Introduced a single, explicit timeout configuration for all HTTP requests, removing duplicated and implicit timeout behavior while preserving runtime semantics.

6. `860126a` — Make campaign persistence safe and idempotent
   Reworked the database layer to use a shared connection pool, parameterized SQL queries, and idempotent upserts to prevent duplicate data, SQL injection, and connection leaks.

7. `88acd08` — Decompose sync logic into focused units
   Refactored the monolithic sync function into clear, single-responsibility units for authentication, pagination, and campaign syncing, improving readability and testability without changing behavior.


---

**Thank you for reviewing my submission!**



./.env.example
# Ad Platform API Configuration
AD_PLATFORM_API_URL=http://localhost:3001
AD_PLATFORM_EMAIL=admin@mixoads.com
AD_PLATFORM_PASSWORD=SuperSecret123!

# Database Configuration (for future use)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=mixoads
DB_USER=postgres
DB_PASSWORD=postgres

# Optional: Use mock DB for assignment (set to true)
USE_MOCK_DB=true

./.env
# Ad Platform API Configuration
AD_PLATFORM_API_URL=http://localhost:3001
AD_PLATFORM_EMAIL=admin@mixoads.com
AD_PLATFORM_PASSWORD=SuperSecret123!

# Database Configuration (for future use)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=mixoads
DB_USER=postgres
DB_PASSWORD=postgres

# Optional: Use mock DB for assignment (set to true)
USE_MOCK_DB=true


./.gitignore
# Dependencies
node_modules/
package-lock.json

# Build outputs
dist/
build/

# Environment variables
.env
.env.local

# Logs
*.log
npm-debug.log*

# OS
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/
*.swp
*.swo

# Hiring materials (keep private)
HIRING_GUIDE.md


./package.json
{
  "name": "mixoads-backend-assignment",
  "version": "1.0.0",
  "description": "Backend engineering assignment for Mixo Ads",
  "main": "src/index.ts",
  "scripts": {
    "start": "ts-node src/index.ts",
    "dev": "ts-node-dev --respawn src/index.ts"
  },
  "keywords": ["backend", "assignment", "mixoads"],
  "author": "Mixo Ads",
  "license": "ISC",
  "dependencies": {
    "node-fetch": "^2.7.0",
    "pg": "^8.11.0",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "@types/node": "^20.10.0",
    "@types/node-fetch": "^2.6.9",
    "@types/pg": "^8.10.9",
    "ts-node": "^10.9.2",
    "ts-node-dev": "^2.0.0",
    "typescript": "^5.3.3"
  }
}

./mock-api/server.js
const express = require('express');
const app = express();

const requestCounts = new Map();
const RATE_LIMIT = 10;
const RATE_WINDOW = 60000;

const TOKEN_EXPIRY_TIME = 3600;
let tokenIssuedAt = Date.now();

let requestCounter = 0;

app.use(express.json());

app.use((req, res, next) => {
  console.log(`[${new Date().toISOString()}] ${req.method} ${req.path}`);
  next();
});

app.post('/auth/token', (req, res) => {
  const authHeader = req.headers.authorization;

  if (!authHeader || !authHeader.startsWith('Basic ')) {
    return res.status(401).json({
      error: 'Unauthorized',
      message: 'Missing or invalid Authorization header. Expected: Basic <base64>'
    });
  }

  const base64Creds = authHeader.replace('Basic ', '');
  let decoded;

  try {
    decoded = Buffer.from(base64Creds, 'base64').toString('utf-8');
  } catch (error) {
    return res.status(401).json({
      error: 'Invalid base64 encoding'
    });
  }

  const [email, password] = decoded.split(':');

  if (email === 'admin@mixoads.com' && password === 'SuperSecret123!') {
    tokenIssuedAt = Date.now();

    console.log('Token issued successfully');

    return res.json({
      access_token: 'mock_access_token_' + Date.now(),
      token_type: 'Bearer',
      expires_in: TOKEN_EXPIRY_TIME,
      issued_at: Math.floor(tokenIssuedAt / 1000)
    });
  }

  console.log('Invalid credentials');
  res.status(401).json({
    error: 'Invalid credentials',
    message: 'Email or password is incorrect'
  });
});

function rateLimitMiddleware(req, res, next) {
  const clientId = req.headers['x-client-id'] || 'default';
  const now = Date.now();

  if (!requestCounts.has(clientId)) {
    requestCounts.set(clientId, []);
  }

  const requests = requestCounts.get(clientId);

  const recentRequests = requests.filter(time => now - time < RATE_WINDOW);

  if (recentRequests.length >= RATE_LIMIT) {
    console.log(`Rate limit exceeded for client: ${clientId}`);
    return res.status(429).json({
      error: 'Rate limit exceeded',
      message: `Too many requests. Limit: ${RATE_LIMIT} per minute`,
      retry_after: 60
    });
  }

  recentRequests.push(now);
  requestCounts.set(clientId, recentRequests);

  next();
}

function authMiddleware(req, res, next) {
  const authHeader = req.headers.authorization;

  if (!authHeader || !authHeader.startsWith('Bearer ')) {
    return res.status(401).json({
      error: 'Unauthorized',
      message: 'Missing or invalid Bearer token'
    });
  }

  const token = authHeader.replace('Bearer ', '');

  const tokenAge = Date.now() - tokenIssuedAt;
  if (tokenAge > TOKEN_EXPIRY_TIME * 1000) {
    console.log('Token expired');
    return res.status(401).json({
      error: 'Token expired',
      message: 'Access token has expired. Please obtain a new token.',
      expired_at: new Date(tokenIssuedAt + TOKEN_EXPIRY_TIME * 1000).toISOString()
    });
  }

  next();
}

app.get('/api/campaigns', authMiddleware, rateLimitMiddleware, (req, res) => {
  requestCounter++;

  if (requestCounter % 5 === 0) {
    console.log('Simulating 503 Service Unavailable');
    return res.status(503).json({
      error: 'Service temporarily unavailable',
      message: 'The service is experiencing issues. Please retry after a short delay.'
    });
  }

  if (requestCounter % 10 === 0) {
    console.log('Simulating timeout (no response)');
    return;
  }

  const page = parseInt(req.query.page) || 1;
  const limit = parseInt(req.query.limit) || 10;

  const campaigns = [];
  for (let i = 0; i < limit; i++) {
    const id = (page - 1) * limit + i + 1;
    campaigns.push({
      id: `campaign_${id}`,
      name: `Campaign ${id}`,
      status: 'active',
      budget: 1000 + id * 100,
      impressions: Math.floor(Math.random() * 10000),
      clicks: Math.floor(Math.random() * 500),
      conversions: Math.floor(Math.random() * 50),
      created_at: new Date(Date.now() - id * 86400000).toISOString()
    });
  }

  console.log(`Returning ${campaigns.length} campaigns (page ${page})`);

  res.json({
    data: campaigns,
    pagination: {
      page,
      limit,
      total: 100,
      has_more: page < 10
    }
  });
});

app.post('/api/campaigns/:id/sync', authMiddleware, rateLimitMiddleware, (req, res) => {
  const { id } = req.params;

  console.log(`Syncing campaign: ${id}`);

  setTimeout(() => {
    res.json({
      success: true,
      campaign_id: id,
      synced_at: new Date().toISOString(),
      message: 'Campaign data synced successfully'
    });
  }, 2000);
});

app.get('/api/error', (req, res) => {
  const error = new Error('Simulated server error');
  console.error(error);

  res.status(500).json({
    error: error.message,
    stack: error.stack
  });
});

app.get('/health', (req, res) => {
  res.json({
    status: 'ok',
    timestamp: new Date().toISOString(),
    uptime: process.uptime()
  });
});

const PORT = process.env.PORT || 3001;
app.listen(PORT, () => {
  console.log('='.repeat(60));
  console.log('Mock Ad Platform API Server');
  console.log('='.repeat(60));
  console.log(`Server running on: http://localhost:${PORT}`);
  console.log(`Valid credentials: admin@mixoads.com / SuperSecret123!`);
  console.log(`Token expiry: ${TOKEN_EXPIRY_TIME} seconds (1 hour)`);
  console.log(`Rate limit: ${RATE_LIMIT} requests per minute`);
  console.log('='.repeat(60));
  console.log('\nEndpoints:');
  console.log('  POST /auth/token              - Get access token');
  console.log('  GET  /api/campaigns           - List campaigns (paginated)');
  console.log('  POST /api/campaigns/:id/sync  - Sync campaign data');
  console.log('  GET  /health                  - Health check');
  console.log('='.repeat(60));
});


./mock-api/package-lock.json
{
  "name": "mock-ad-platform-api",
  "version": "1.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "mock-ad-platform-api",
      "version": "1.0.0",
      "license": "ISC",
      "dependencies": {
        "express": "^4.18.2"
      }
    },
    "node_modules/accepts": {
      "version": "1.3.8",
      "resolved": "https://registry.npmjs.org/accepts/-/accepts-1.3.8.tgz",
      "integrity": "sha512-PYAthTa2m2VKxuvSD3DPC/Gy+U+sOA1LAuT8mkmRuvw+NACSaeXEQ+NHcVF7rONl6qcaxV3Uuemwawk+7+SJLw==",
      "license": "MIT",
      "dependencies": {
        "mime-types": "~2.1.34",
        "negotiator": "0.6.3"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/array-flatten": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/array-flatten/-/array-flatten-1.1.1.tgz",
      "integrity": "sha512-PCVAQswWemu6UdxsDFFX/+gVeYqKAod3D3UVm91jHwynguOwAvYPhx8nNlM++NqRcK6CxxpUafjmhIdKiHibqg==",
      "license": "MIT"
    },
    "node_modules/body-parser": {
      "version": "1.20.4",
      "resolved": "https://registry.npmjs.org/body-parser/-/body-parser-1.20.4.tgz",
      "integrity": "sha512-ZTgYYLMOXY9qKU/57FAo8F+HA2dGX7bqGc71txDRC1rS4frdFI5R7NhluHxH6M0YItAP0sHB4uqAOcYKxO6uGA==",
      "license": "MIT",
      "dependencies": {
        "bytes": "~3.1.2",
        "content-type": "~1.0.5",
        "debug": "2.6.9",
        "depd": "2.0.0",
        "destroy": "~1.2.0",
        "http-errors": "~2.0.1",
        "iconv-lite": "~0.4.24",
        "on-finished": "~2.4.1",
        "qs": "~6.14.0",
        "raw-body": "~2.5.3",
        "type-is": "~1.6.18",
        "unpipe": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8",
        "npm": "1.2.8000 || >= 1.4.16"
      }
    },
    "node_modules/bytes": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/bytes/-/bytes-3.1.2.tgz",
      "integrity": "sha512-/Nf7TyzTx6S3yRJObOAV7956r8cr2+Oj8AC5dt8wSP3BQAoeX58NoHyCU8P8zGkNXStjTSi6fzO6F0pBdcYbEg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/call-bind-apply-helpers": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/call-bind-apply-helpers/-/call-bind-apply-helpers-1.0.2.tgz",
      "integrity": "sha512-Sp1ablJ0ivDkSzjcaJdxEunN5/XvksFJ2sMBFfq6x0ryhQV/2b/KwFe21cMpmHtPOSij8K99/wSfoEuTObmuMQ==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/call-bound": {
      "version": "1.0.4",
      "resolved": "https://registry.npmjs.org/call-bound/-/call-bound-1.0.4.tgz",
      "integrity": "sha512-+ys997U96po4Kx/ABpBCqhA9EuxJaQWDQg7295H4hBphv3IZg0boBKuwYpt4YXp6MZ5AmZQnU/tyMTlRpaSejg==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "get-intrinsic": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/content-disposition": {
      "version": "0.5.4",
      "resolved": "https://registry.npmjs.org/content-disposition/-/content-disposition-0.5.4.tgz",
      "integrity": "sha512-FveZTNuGw04cxlAiWbzi6zTAL/lhehaWbTtgluJh4/E95DqMwTmha3KZN1aAWA8cFIhHzMZUvLevkw5Rqk+tSQ==",
      "license": "MIT",
      "dependencies": {
        "safe-buffer": "5.2.1"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/content-type": {
      "version": "1.0.5",
      "resolved": "https://registry.npmjs.org/content-type/-/content-type-1.0.5.tgz",
      "integrity": "sha512-nTjqfcBFEipKdXCv4YDQWCfmcLZKm81ldF0pAopTvyrFGVbcR6P/VAAd5G7N+0tTr8QqiU0tFadD6FK4NtJwOA==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie": {
      "version": "0.7.2",
      "resolved": "https://registry.npmjs.org/cookie/-/cookie-0.7.2.tgz",
      "integrity": "sha512-yki5XnKuf750l50uGTllt6kKILY4nQ1eNIQatoXEByZ5dWgnKqbnqmTrBE5B4N7lrMJKQ2ytWMiTO2o0v6Ew/w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/cookie-signature": {
      "version": "1.0.7",
      "resolved": "https://registry.npmjs.org/cookie-signature/-/cookie-signature-1.0.7.tgz",
      "integrity": "sha512-NXdYc3dLr47pBkpUCHtKSwIOQXLVn8dZEuywboCOJY/osA0wFSLlSawr3KN8qXJEyX66FcONTH8EIlVuK0yyFA==",
      "license": "MIT"
    },
    "node_modules/debug": {
      "version": "2.6.9",
      "resolved": "https://registry.npmjs.org/debug/-/debug-2.6.9.tgz",
      "integrity": "sha512-bC7ElrdJaJnPbAP+1EotYvqZsb3ecl5wi6Bfi6BJTUcNowp6cvspg0jXznRTKDjm/E7AdgFBVeAPVMNcKGsHMA==",
      "license": "MIT",
      "dependencies": {
        "ms": "2.0.0"
      }
    },
    "node_modules/depd": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/depd/-/depd-2.0.0.tgz",
      "integrity": "sha512-g7nH6P6dyDioJogAAGprGpCtVImJhpPk/roCzdb3fIh61/s/nPsfR6onyMwkCAR/OlC3yBC0lESvUoQEAssIrw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/destroy": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/destroy/-/destroy-1.2.0.tgz",
      "integrity": "sha512-2sJGJTaXIIaR1w4iJSNoN0hnMY7Gpc/n8D4qSCJw8QqFWXf7cuAgnEHxBpweaVcPevC2l3KpjYCx3NypQQgaJg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8",
        "npm": "1.2.8000 || >= 1.4.16"
      }
    },
    "node_modules/dunder-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/dunder-proto/-/dunder-proto-1.0.1.tgz",
      "integrity": "sha512-KIN/nDJBQRcXw0MLVhZE9iQHmG68qAVIBg9CqmUYjmQIhgij9U5MFvrqkUL5FbtyyzZuOeOt0zdeRe4UY7ct+A==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.1",
        "es-errors": "^1.3.0",
        "gopd": "^1.2.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/ee-first": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/ee-first/-/ee-first-1.1.1.tgz",
      "integrity": "sha512-WMwm9LhRUo+WUaRN+vRuETqG89IgZphVSNkdFgeb6sS/E4OrDIN7t48CAewSHXc6C8lefD8KKfr5vY61brQlow==",
      "license": "MIT"
    },
    "node_modules/encodeurl": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/encodeurl/-/encodeurl-2.0.0.tgz",
      "integrity": "sha512-Q0n9HRi4m6JuGIV1eFlmvJB7ZEVxu93IrMyiMsGC0lrMJMWzRgx6WGquyfQgZVb31vhGgXnfmPNNXmxnOkRBrg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/es-define-property": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/es-define-property/-/es-define-property-1.0.1.tgz",
      "integrity": "sha512-e3nRfgfUZ4rNGL232gUgX06QNyyez04KdjFrF+LTRoOXmrOgFKDg4BCdsjW8EnT69eqdYGmRpJwiPVYNrCaW3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-errors": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/es-errors/-/es-errors-1.3.0.tgz",
      "integrity": "sha512-Zf5H2Kxt2xjTvbJvP2ZWLEICxA6j+hAmMzIlypy4xcBg1vKVnx89Wy0GbS+kf5cwCVFFzdCFh2XSCFNULS6csw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/es-object-atoms": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/es-object-atoms/-/es-object-atoms-1.1.1.tgz",
      "integrity": "sha512-FGgH2h8zKNim9ljj7dankFPcICIK9Cp5bm+c2gQSYePhpaG5+esrLODihIorn+Pe6FGJzWhXQotPv73jTaldXA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/escape-html": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/escape-html/-/escape-html-1.0.3.tgz",
      "integrity": "sha512-NiSupZ4OeuGwr68lGIeym/ksIZMJodUGOSCZ/FSnTxcrekbvqrgdUxlJOMpijaKZVjAJrWrGs/6Jy8OMuyj9ow==",
      "license": "MIT"
    },
    "node_modules/etag": {
      "version": "1.8.1",
      "resolved": "https://registry.npmjs.org/etag/-/etag-1.8.1.tgz",
      "integrity": "sha512-aIL5Fx7mawVa300al2BnEE4iNvo1qETxLrPI/o05L7z6go7fCw1J6EQmbK4FmJ2AS7kgVF/KEZWufBfdClMcPg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/express": {
      "version": "4.22.1",
      "resolved": "https://registry.npmjs.org/express/-/express-4.22.1.tgz",
      "integrity": "sha512-F2X8g9P1X7uCPZMA3MVf9wcTqlyNp7IhH5qPCI0izhaOIYXaW9L535tGA3qmjRzpH+bZczqq7hVKxTR4NWnu+g==",
      "license": "MIT",
      "dependencies": {
        "accepts": "~1.3.8",
        "array-flatten": "1.1.1",
        "body-parser": "~1.20.3",
        "content-disposition": "~0.5.4",
        "content-type": "~1.0.4",
        "cookie": "~0.7.1",
        "cookie-signature": "~1.0.6",
        "debug": "2.6.9",
        "depd": "2.0.0",
        "encodeurl": "~2.0.0",
        "escape-html": "~1.0.3",
        "etag": "~1.8.1",
        "finalhandler": "~1.3.1",
        "fresh": "~0.5.2",
        "http-errors": "~2.0.0",
        "merge-descriptors": "1.0.3",
        "methods": "~1.1.2",
        "on-finished": "~2.4.1",
        "parseurl": "~1.3.3",
        "path-to-regexp": "~0.1.12",
        "proxy-addr": "~2.0.7",
        "qs": "~6.14.0",
        "range-parser": "~1.2.1",
        "safe-buffer": "5.2.1",
        "send": "~0.19.0",
        "serve-static": "~1.16.2",
        "setprototypeof": "1.2.0",
        "statuses": "~2.0.1",
        "type-is": "~1.6.18",
        "utils-merge": "1.0.1",
        "vary": "~1.1.2"
      },
      "engines": {
        "node": ">= 0.10.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/finalhandler": {
      "version": "1.3.2",
      "resolved": "https://registry.npmjs.org/finalhandler/-/finalhandler-1.3.2.tgz",
      "integrity": "sha512-aA4RyPcd3badbdABGDuTXCMTtOneUCAYH/gxoYRTZlIJdF0YPWuGqiAsIrhNnnqdXGswYk6dGujem4w80UJFhg==",
      "license": "MIT",
      "dependencies": {
        "debug": "2.6.9",
        "encodeurl": "~2.0.0",
        "escape-html": "~1.0.3",
        "on-finished": "~2.4.1",
        "parseurl": "~1.3.3",
        "statuses": "~2.0.2",
        "unpipe": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/forwarded": {
      "version": "0.2.0",
      "resolved": "https://registry.npmjs.org/forwarded/-/forwarded-0.2.0.tgz",
      "integrity": "sha512-buRG0fpBtRHSTCOASe6hD258tEubFoRLb4ZNA6NxMVHNw2gOcwHo9wyablzMzOA5z9xA9L1KNjk/Nt6MT9aYow==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/fresh": {
      "version": "0.5.2",
      "resolved": "https://registry.npmjs.org/fresh/-/fresh-0.5.2.tgz",
      "integrity": "sha512-zJ2mQYM18rEFOudeV4GShTGIQ7RbzA7ozbU9I/XBpm7kqgMywgmylMwXHxZJmkVoYkna9d2pVXVXPdYTP9ej8Q==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/function-bind": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/function-bind/-/function-bind-1.1.2.tgz",
      "integrity": "sha512-7XHNxH7qX9xG5mIwxkhumTox/MIRNcOgDrxWsMt2pAr23WHp6MrRlN7FBSFpCpr+oVO0F744iUgR82nJMfG2SA==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-intrinsic": {
      "version": "1.3.0",
      "resolved": "https://registry.npmjs.org/get-intrinsic/-/get-intrinsic-1.3.0.tgz",
      "integrity": "sha512-9fSjSaos/fRIVIp+xSJlE6lfwhES7LNtKaCBIamHsjr2na1BiABJPo0mOjjz8GJDURarmCPGqaiVg5mfjb98CQ==",
      "license": "MIT",
      "dependencies": {
        "call-bind-apply-helpers": "^1.0.2",
        "es-define-property": "^1.0.1",
        "es-errors": "^1.3.0",
        "es-object-atoms": "^1.1.1",
        "function-bind": "^1.1.2",
        "get-proto": "^1.0.1",
        "gopd": "^1.2.0",
        "has-symbols": "^1.1.0",
        "hasown": "^2.0.2",
        "math-intrinsics": "^1.1.0"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/get-proto": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/get-proto/-/get-proto-1.0.1.tgz",
      "integrity": "sha512-sTSfBjoXBp89JvIKIefqw7U2CCebsc74kiY6awiGogKtoSGbgjYE/G/+l9sF3MWFPNc9IcoOC4ODfKHfxFmp0g==",
      "license": "MIT",
      "dependencies": {
        "dunder-proto": "^1.0.1",
        "es-object-atoms": "^1.0.0"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/gopd": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/gopd/-/gopd-1.2.0.tgz",
      "integrity": "sha512-ZUKRh6/kUFoAiTAtTYPZJ3hw9wNxx+BIBOijnlG9PnrJsCcSjs1wyyD6vJpaYtgnzDrKYRSqf3OO6Rfa93xsRg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/has-symbols": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/has-symbols/-/has-symbols-1.1.0.tgz",
      "integrity": "sha512-1cDNdwJ2Jaohmb3sg4OmKaMBwuC48sYni5HUw2DvsC8LjGTLK9h+eb1X6RyuOHe4hT0ULCW68iomhjUoKUqlPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/hasown": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/hasown/-/hasown-2.0.2.tgz",
      "integrity": "sha512-0hJU9SCPvmMzIBdZFqNPXWa6dqh7WdH0cII9y+CyS8rG3nL48Bclra9HmKhVVUHyPWNH5Y7xDwAB7bfgSjkUMQ==",
      "license": "MIT",
      "dependencies": {
        "function-bind": "^1.1.2"
      },
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/http-errors": {
      "version": "2.0.1",
      "resolved": "https://registry.npmjs.org/http-errors/-/http-errors-2.0.1.tgz",
      "integrity": "sha512-4FbRdAX+bSdmo4AUFuS0WNiPz8NgFt+r8ThgNWmlrjQjt1Q7ZR9+zTlce2859x4KSXrwIsaeTqDoKQmtP8pLmQ==",
      "license": "MIT",
      "dependencies": {
        "depd": "~2.0.0",
        "inherits": "~2.0.4",
        "setprototypeof": "~1.2.0",
        "statuses": "~2.0.2",
        "toidentifier": "~1.0.1"
      },
      "engines": {
        "node": ">= 0.8"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/express"
      }
    },
    "node_modules/iconv-lite": {
      "version": "0.4.24",
      "resolved": "https://registry.npmjs.org/iconv-lite/-/iconv-lite-0.4.24.tgz",
      "integrity": "sha512-v3MXnZAcvnywkTUEZomIActle7RXXeedOR31wwl7VlyoXO4Qi9arvSenNQWne1TcRwhCL1HwLI21bEqdpj8/rA==",
      "license": "MIT",
      "dependencies": {
        "safer-buffer": ">= 2.1.2 < 3"
      },
      "engines": {
        "node": ">=0.10.0"
      }
    },
    "node_modules/inherits": {
      "version": "2.0.4",
      "resolved": "https://registry.npmjs.org/inherits/-/inherits-2.0.4.tgz",
      "integrity": "sha512-k/vGaX4/Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==",
      "license": "ISC"
    },
    "node_modules/ipaddr.js": {
      "version": "1.9.1",
      "resolved": "https://registry.npmjs.org/ipaddr.js/-/ipaddr.js-1.9.1.tgz",
      "integrity": "sha512-0KI/607xoxSToH7GjN1FfSbLoU0+btTicjsQSWQlh/hZykN8KpmMf7uYwPW3R+akZ6R/w18ZlXSHBYXiYUPO3g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/math-intrinsics": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/math-intrinsics/-/math-intrinsics-1.1.0.tgz",
      "integrity": "sha512-/IXtbwEk5HTPyEwyKX6hGkYXxM9nbj64B+ilVJnC/R6B0pH5G4V3b0pVbL7DBj4tkhBAppbQUlf6F6Xl9LHu1g==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      }
    },
    "node_modules/media-typer": {
      "version": "0.3.0",
      "resolved": "https://registry.npmjs.org/media-typer/-/media-typer-0.3.0.tgz",
      "integrity": "sha512-dq+qelQ9akHpcOl/gUVRTxVIOkAJ1wR3QAvb4RsVjS8oVoFjDGTc679wJYmUmknUF5HwMLOgb5O+a3KxfWapPQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/merge-descriptors": {
      "version": "1.0.3",
      "resolved": "https://registry.npmjs.org/merge-descriptors/-/merge-descriptors-1.0.3.tgz",
      "integrity": "sha512-gaNvAS7TZ897/rVaZ0nMtAyxNyi/pdbjbAwUpFQpN70GqnVfOiXpeUUMKRBmzXaSQ8DdTX4/0ms62r2K+hE6mQ==",
      "license": "MIT",
      "funding": {
        "url": "https://github.com/sponsors/sindresorhus"
      }
    },
    "node_modules/methods": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/methods/-/methods-1.1.2.tgz",
      "integrity": "sha512-iclAHeNqNm68zFtnZ0e+1L2yUIdvzNoauKU4WBA3VvH/vPFieF7qfRlwUZU+DA9P9bPXIS90ulxoUoCH23sV2w==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime": {
      "version": "1.6.0",
      "resolved": "https://registry.npmjs.org/mime/-/mime-1.6.0.tgz",
      "integrity": "sha512-x0Vn8spI+wuJ1O6S7gnbaQg8Pxh4NNHb7KSINmEWKiPE4RKOplvijn+NkmYmmRgP68mc70j2EbeTFRsrswaQeg==",
      "license": "MIT",
      "bin": {
        "mime": "cli.js"
      },
      "engines": {
        "node": ">=4"
      }
    },
    "node_modules/mime-db": {
      "version": "1.52.0",
      "resolved": "https://registry.npmjs.org/mime-db/-/mime-db-1.52.0.tgz",
      "integrity": "sha512-sPU4uV7dYlvtWJxwwxHD0PuihVNiE7TyAbQ5SWxDCB9mUYvOgroQOwYQQOKPJ8CIbE+1ETVlOoK1UC2nU3gYvg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/mime-types": {
      "version": "2.1.35",
      "resolved": "https://registry.npmjs.org/mime-types/-/mime-types-2.1.35.tgz",
      "integrity": "sha512-ZDY+bPm5zTTF+YpCrAU9nK0UgICYPT0QtT1NZWFv4s++TNkcgVaT0g6+4R2uI4MjQjzysHB1zxuWL50hzaeXiw==",
      "license": "MIT",
      "dependencies": {
        "mime-db": "1.52.0"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/ms": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.0.0.tgz",
      "integrity": "sha512-Tpp60P6IUJDTuOq/5Z8cdskzJujfwqfOTkrwIwj7IRISpnkJnT6SyJ4PCPnGMoFjC9ddhal5KVIYtAt97ix05A==",
      "license": "MIT"
    },
    "node_modules/negotiator": {
      "version": "0.6.3",
      "resolved": "https://registry.npmjs.org/negotiator/-/negotiator-0.6.3.tgz",
      "integrity": "sha512-+EUsqGPLsM+j/zdChZjsnX51g4XrHFOIXwfnCVPGlQk/k5giakcKsuxCObBRu6DSm9opw/O6slWbJdghQM4bBg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/object-inspect": {
      "version": "1.13.4",
      "resolved": "https://registry.npmjs.org/object-inspect/-/object-inspect-1.13.4.tgz",
      "integrity": "sha512-W67iLl4J2EXEGTbfeHCffrjDfitvLANg0UlX3wFUUSTx92KXRFegMHUVgSqE+wvhAbi4WqjGg9czysTV2Epbew==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/on-finished": {
      "version": "2.4.1",
      "resolved": "https://registry.npmjs.org/on-finished/-/on-finished-2.4.1.tgz",
      "integrity": "sha512-oVlzkg3ENAhCk2zdv7IJwd/QUD4z2RxRwpkcGY8psCVcCYZNq4wYnVWALHM+brtuJjePWiYF/ClmuDr8Ch5+kg==",
      "license": "MIT",
      "dependencies": {
        "ee-first": "1.1.1"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/parseurl": {
      "version": "1.3.3",
      "resolved": "https://registry.npmjs.org/parseurl/-/parseurl-1.3.3.tgz",
      "integrity": "sha512-CiyeOxFT/JZyN5m0z9PfXw4SCBJ6Sygz1Dpl0wqjlhDEGGBP1GnsUVEL0p63hoG1fcj3fHynXi9NYO4nWOL+qQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/path-to-regexp": {
      "version": "0.1.12",
      "resolved": "https://registry.npmjs.org/path-to-regexp/-/path-to-regexp-0.1.12.tgz",
      "integrity": "sha512-RA1GjUVMnvYFxuqovrEqZoxxW5NUZqbwKtYz/Tt7nXerk0LbLblQmrsgdeOxV5SFHf0UDggjS/bSeOZwt1pmEQ==",
      "license": "MIT"
    },
    "node_modules/proxy-addr": {
      "version": "2.0.7",
      "resolved": "https://registry.npmjs.org/proxy-addr/-/proxy-addr-2.0.7.tgz",
      "integrity": "sha512-llQsMLSUDUPT44jdrU/O37qlnifitDP+ZwrmmZcoSKyLKvtZxpyV0n2/bD/N4tBAAZ/gJEdZU7KMraoK1+XYAg==",
      "license": "MIT",
      "dependencies": {
        "forwarded": "0.2.0",
        "ipaddr.js": "1.9.1"
      },
      "engines": {
        "node": ">= 0.10"
      }
    },
    "node_modules/qs": {
      "version": "6.14.0",
      "resolved": "https://registry.npmjs.org/qs/-/qs-6.14.0.tgz",
      "integrity": "sha512-YWWTjgABSKcvs/nWBi9PycY/JiPJqOD4JA6o9Sej2AtvSGarXxKC3OQSk4pAarbdQlKAh5D4FCQkJNkW+GAn3w==",
      "license": "BSD-3-Clause",
      "dependencies": {
        "side-channel": "^1.1.0"
      },
      "engines": {
        "node": ">=0.6"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/range-parser": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/range-parser/-/range-parser-1.2.1.tgz",
      "integrity": "sha512-Hrgsx+orqoygnmhFbKaHE6c296J+HTAQXoxEF6gNupROmmGJRoyzfG3ccAveqCBrwr/2yxQ5BVd/GTl5agOwSg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/raw-body": {
      "version": "2.5.3",
      "resolved": "https://registry.npmjs.org/raw-body/-/raw-body-2.5.3.tgz",
      "integrity": "sha512-s4VSOf6yN0rvbRZGxs8Om5CWj6seneMwK3oDb4lWDH0UPhWcxwOWw5+qk24bxq87szX1ydrwylIOp2uG1ojUpA==",
      "license": "MIT",
      "dependencies": {
        "bytes": "~3.1.2",
        "http-errors": "~2.0.1",
        "iconv-lite": "~0.4.24",
        "unpipe": "~1.0.0"
      },
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/safe-buffer": {
      "version": "5.2.1",
      "resolved": "https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.1.tgz",
      "integrity": "sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==",
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/feross"
        },
        {
          "type": "patreon",
          "url": "https://www.patreon.com/feross"
        },
        {
          "type": "consulting",
          "url": "https://feross.org/support"
        }
      ],
      "license": "MIT"
    },
    "node_modules/safer-buffer": {
      "version": "2.1.2",
      "resolved": "https://registry.npmjs.org/safer-buffer/-/safer-buffer-2.1.2.tgz",
      "integrity": "sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==",
      "license": "MIT"
    },
    "node_modules/send": {
      "version": "0.19.2",
      "resolved": "https://registry.npmjs.org/send/-/send-0.19.2.tgz",
      "integrity": "sha512-VMbMxbDeehAxpOtWJXlcUS5E8iXh6QmN+BkRX1GARS3wRaXEEgzCcB10gTQazO42tpNIya8xIyNx8fll1OFPrg==",
      "license": "MIT",
      "dependencies": {
        "debug": "2.6.9",
        "depd": "2.0.0",
        "destroy": "1.2.0",
        "encodeurl": "~2.0.0",
        "escape-html": "~1.0.3",
        "etag": "~1.8.1",
        "fresh": "~0.5.2",
        "http-errors": "~2.0.1",
        "mime": "1.6.0",
        "ms": "2.1.3",
        "on-finished": "~2.4.1",
        "range-parser": "~1.2.1",
        "statuses": "~2.0.2"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/send/node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "license": "MIT"
    },
    "node_modules/serve-static": {
      "version": "1.16.3",
      "resolved": "https://registry.npmjs.org/serve-static/-/serve-static-1.16.3.tgz",
      "integrity": "sha512-x0RTqQel6g5SY7Lg6ZreMmsOzncHFU7nhnRWkKgWuMTu5NN0DR5oruckMqRvacAN9d5w6ARnRBXl9xhDCgfMeA==",
      "license": "MIT",
      "dependencies": {
        "encodeurl": "~2.0.0",
        "escape-html": "~1.0.3",
        "parseurl": "~1.3.3",
        "send": "~0.19.1"
      },
      "engines": {
        "node": ">= 0.8.0"
      }
    },
    "node_modules/setprototypeof": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/setprototypeof/-/setprototypeof-1.2.0.tgz",
      "integrity": "sha512-E5LDX7Wrp85Kil5bhZv46j8jOeboKq5JMmYM3gVGdGH8xFpPWXUMsNrlODCrkoxMEeNi/XZIwuRvY4XNwYMJpw==",
      "license": "ISC"
    },
    "node_modules/side-channel": {
      "version": "1.1.0",
      "resolved": "https://registry.npmjs.org/side-channel/-/side-channel-1.1.0.tgz",
      "integrity": "sha512-ZX99e6tRweoUXqR+VBrslhda51Nh5MTQwou5tnUDgbtyM0dBgmhEDtWGP/xbKn6hqfPRHujUNwz5fy/wbbhnpw==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3",
        "side-channel-list": "^1.0.0",
        "side-channel-map": "^1.0.1",
        "side-channel-weakmap": "^1.0.2"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-list": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/side-channel-list/-/side-channel-list-1.0.0.tgz",
      "integrity": "sha512-FCLHtRD/gnpCiCHEiJLOwdmFP+wzCmDEkc9y7NsYxeF4u7Btsn1ZuwgwJGxImImHicJArLP4R0yX4c2KCrMrTA==",
      "license": "MIT",
      "dependencies": {
        "es-errors": "^1.3.0",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-map": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/side-channel-map/-/side-channel-map-1.0.1.tgz",
      "integrity": "sha512-VCjCNfgMsby3tTdo02nbjtM/ewra6jPHmpThenkTYh8pG9ucZ/1P8So4u4FGBek/BjpOVsDCMoLA/iuBKIFXRA==",
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/side-channel-weakmap": {
      "version": "1.0.2",
      "resolved": "https://registry.npmjs.org/side-channel-weakmap/-/side-channel-weakmap-1.0.2.tgz",
      "integrity": "sha512-WPS/HvHQTYnHisLo9McqBHOJk2FkHO/tlpvldyrnem4aeQp4hai3gythswg6p01oSoTl58rcpiFAjF2br2Ak2A==",
      "license": "MIT",
      "dependencies": {
        "call-bound": "^1.0.2",
        "es-errors": "^1.3.0",
        "get-intrinsic": "^1.2.5",
        "object-inspect": "^1.13.3",
        "side-channel-map": "^1.0.1"
      },
      "engines": {
        "node": ">= 0.4"
      },
      "funding": {
        "url": "https://github.com/sponsors/ljharb"
      }
    },
    "node_modules/statuses": {
      "version": "2.0.2",
      "resolved": "https://registry.npmjs.org/statuses/-/statuses-2.0.2.tgz",
      "integrity": "sha512-DvEy55V3DB7uknRo+4iOGT5fP1slR8wQohVdknigZPMpMstaKJQWhwiYBACJE3Ul2pTnATihhBYnRhZQHGBiRw==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/toidentifier": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/toidentifier/-/toidentifier-1.0.1.tgz",
      "integrity": "sha512-o5sSPKEkg/DIQNmH43V0/uerLrpzVedkUh8tGNvaeXpfpuwjKenlSox/2O/BTlZUtEe+JG7s5YhEz608PlAHRA==",
      "license": "MIT",
      "engines": {
        "node": ">=0.6"
      }
    },
    "node_modules/type-is": {
      "version": "1.6.18",
      "resolved": "https://registry.npmjs.org/type-is/-/type-is-1.6.18.tgz",
      "integrity": "sha512-TkRKr9sUTxEH8MdfuCSP7VizJyzRNMjj2J2do2Jr3Kym598JVdEksuzPQCnlFPW4ky9Q+iA+ma9BGm06XQBy8g==",
      "license": "MIT",
      "dependencies": {
        "media-typer": "0.3.0",
        "mime-types": "~2.1.24"
      },
      "engines": {
        "node": ">= 0.6"
      }
    },
    "node_modules/unpipe": {
      "version": "1.0.0",
      "resolved": "https://registry.npmjs.org/unpipe/-/unpipe-1.0.0.tgz",
      "integrity": "sha512-pjy2bYhSsufwWlKwPc+l3cN7+wuJlK6uz0YdJEOlQDbl6jo/YlPi4mb8agUkVC8BF7V8NuzeyPNqRksA3hztKQ==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    },
    "node_modules/utils-merge": {
      "version": "1.0.1",
      "resolved": "https://registry.npmjs.org/utils-merge/-/utils-merge-1.0.1.tgz",
      "integrity": "sha512-pMZTvIkT1d+TFGvDOqodOclx0QWkkgi6Tdoa8gC8ffGAAqz9pzPTZWAybbsHHoED/ztMtkv/VoYTYyShUn81hA==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.4.0"
      }
    },
    "node_modules/vary": {
      "version": "1.1.2",
      "resolved": "https://registry.npmjs.org/vary/-/vary-1.1.2.tgz",
      "integrity": "sha512-BNGbWLfd0eUPabhkXUVm0j8uuvREyTh5ovRa/dyow/BqAbZJyC+5fU+IzQOzmAKzYqYRAISoRhdQr3eIZ/PXqg==",
      "license": "MIT",
      "engines": {
        "node": ">= 0.8"
      }
    }
  }
}


./mock-api/package.json
{
  "name": "mock-ad-platform-api",
  "version": "1.0.0",
  "description": "Mock Ad Platform API for testing the assignment",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "keywords": ["mock", "api", "testing"],
  "author": "Mixo Ads",
  "license": "ISC",
  "dependencies": {
    "express": "^4.18.2"
  }
}


./src/syncCampaigns.ts
import fetch, { Response } from 'node-fetch';
import { saveCampaignToDB } from './database';

// Configuration constants
const API_BASE_URL = process.env.AD_PLATFORM_API_URL || 'http://localhost:3001';
const PAGE_SIZE = 10;

// Timeout policy (milliseconds)
const REQUEST_TIMEOUT_MS = 5000;

// Rate limit: 10 requests / minute → 1 request every 6 seconds
const MIN_REQUEST_INTERVAL_MS = 6000;
let lastRequestAt = 0;

// Type definitions
interface Campaign {
  id: string;
  name: string;
  status: string;
  budget: number;
  impressions: number;
  clicks: number;
  conversions: number;
  created_at: string;
}

// -----------------
// Shared utilities
// -----------------

async function sleep(ms: number) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function rateLimitGuard() {
  const now = Date.now();
  const elapsed = now - lastRequestAt;

  if (elapsed < MIN_REQUEST_INTERVAL_MS) {
    await sleep(MIN_REQUEST_INTERVAL_MS - elapsed);
  }

  lastRequestAt = Date.now();
}

async function fetchWithTimeout(
  url: string,
  options: any,
  timeoutMs: number
): Promise<Response> {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeoutMs);

  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error: any) {
    if (error.name === 'AbortError') {
      throw new Error('Request timeout');
    }
    throw error;
  }
}

async function fetchWithRetry(
  url: string,
  options: any,
  maxRetries = 5
): Promise<Response> {
  let attempt = 0;
  let delay = 500;

  while (true) {
    try {
      await rateLimitGuard();
      const response = await fetchWithTimeout(
        url,
        options,
        REQUEST_TIMEOUT_MS
      );

      if (response.status === 429) {
        const retryAfter = response.headers.get('retry-after');
        const waitTime = retryAfter
          ? parseInt(retryAfter, 10) * 1000
          : delay;

        await sleep(waitTime);
        throw new Error('Rate limited');
      }

      if (response.status >= 500) {
        throw new Error(`Server error ${response.status}`);
      }

      return response;
    } catch (error: any) {
      attempt++;

      if (attempt > maxRetries) {
        throw new Error(
          `Request failed after ${maxRetries} retries: ${error.message}`
        );
      }

      const jitter = Math.floor(Math.random() * 200) - 100;
      await sleep(delay + jitter);
      delay *= 2;
    }
  }
}

// -----------------
// Capability units
// -----------------

async function getAccessToken(): Promise<string> {
  const email = process.env.AD_PLATFORM_EMAIL;
  const password = process.env.AD_PLATFORM_PASSWORD;

  if (!email || !password) {
    throw new Error('Missing Ad Platform credentials in environment variables');
  }

  const authString = Buffer.from(`${email}:${password}`).toString('base64');

  const response = await fetchWithTimeout(
    `${API_BASE_URL}/auth/token`,
    {
      method: 'POST',
      headers: {
        Authorization: `Basic ${authString}`,
      },
    },
    REQUEST_TIMEOUT_MS
  );

  if (!response.ok) {
    throw new Error(`Authentication failed with status ${response.status}`);
  }

  const data: any = await response.json();
  if (!data.access_token) {
    throw new Error('Authentication response missing access token');
  }

  return data.access_token;
}

async function fetchAllCampaigns(accessToken: string): Promise<Campaign[]> {
  let campaigns: Campaign[] = [];
  let page = 1;
  let hasMore = true;

  while (hasMore) {
    const response = await fetchWithRetry(
      `${API_BASE_URL}/api/campaigns?page=${page}&limit=${PAGE_SIZE}`,
      {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
      }
    );

    if (!response.ok) {
      throw new Error(
        `Failed to fetch campaigns (page ${page}): ${response.status}`
      );
    }

    const data: any = await response.json();
    campaigns.push(...data.data);
    hasMore = data.pagination.has_more;
    page++;
  }

  return campaigns;
}

async function syncCampaign(
  campaign: Campaign,
  accessToken: string
): Promise<void> {
  const response = await fetchWithRetry(
    `${API_BASE_URL}/api/campaigns/${campaign.id}/sync`,
    {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${accessToken}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ campaign_id: campaign.id }),
    }
  );

  await response.json();
  await saveCampaignToDB(campaign);
}

// -----------------
// Orchestrator
// -----------------

export async function syncAllCampaigns() {
  console.log('Syncing campaigns from Ad Platform...\n');

  console.log('Step 1: Authenticating...');
  const accessToken = await getAccessToken();
  console.log('Access token obtained');

  console.log('\nStep 2: Fetching campaigns...');
  const campaigns = await fetchAllCampaigns(accessToken);
  console.log(`Fetched ${campaigns.length} campaigns`);

  console.log('\nStep 3: Syncing campaigns...');
  let successCount = 0;

  for (const campaign of campaigns) {
    console.log(`\n   Syncing: ${campaign.name} (${campaign.id})`);

    try {
      await syncCampaign(campaign, accessToken);
      successCount++;
      console.log(`   Successfully synced ${campaign.name}`);
    } catch (error: any) {
      console.error(
        `   Failed to sync ${campaign.name}:`,
        error.message
      );
    }
  }

  console.log('\n' + '='.repeat(60));
  console.log(
    `Sync complete: ${successCount}/${campaigns.length} campaigns synced`
  );
  console.log('='.repeat(60));
}



./src/index.ts
import dotenv from 'dotenv';
import { syncAllCampaigns } from './syncCampaigns';

dotenv.config();

async function main() {
  console.log('Starting campaign sync...');
  console.log('='.repeat(60));

  try {
    await syncAllCampaigns();
    console.log('\nSync completed successfully!');
  } catch (error) {
    console.error('\nSync failed:', error);
    process.exit(1);
  }
}

main();


./src/database.ts
import { Pool } from 'pg';

// Create a single shared pool
const pool = new Pool({
  host: process.env.DB_HOST || 'localhost',
  port: parseInt(process.env.DB_PORT || '5432', 10),
  database: process.env.DB_NAME || 'mixoads',
  user: process.env.DB_USER || 'postgres',
  password: process.env.DB_PASSWORD || 'postgres',
});

export async function saveCampaignToDB(campaign: any) {
  if (process.env.USE_MOCK_DB === 'true') {
    console.log(`      [MOCK DB] Saved campaign: ${campaign.id}`);
    return;
  }

  const query = `
    INSERT INTO campaigns (
      id,
      name,
      status,
      budget,
      impressions,
      clicks,
      conversions,
      synced_at
    )
    VALUES ($1, $2, $3, $4, $5, $6, $7, NOW())
    ON CONFLICT (id) DO UPDATE SET
      name = EXCLUDED.name,
      status = EXCLUDED.status,
      budget = EXCLUDED.budget,
      impressions = EXCLUDED.impressions,
      clicks = EXCLUDED.clicks,
      conversions = EXCLUDED.conversions,
      synced_at = NOW()
  `;

  const values = [
    campaign.id,
    campaign.name,
    campaign.status,
    campaign.budget,
    campaign.impressions,
    campaign.clicks,
    campaign.conversions,
  ];

  try {
    await pool.query(query, values);
  } catch (error: any) {
    throw new Error(`Database error while saving campaign ${campaign.id}: ${error.message}`);
  }
}



